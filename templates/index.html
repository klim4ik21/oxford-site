{% extends 'base.html' %}

{% block content %}
<div class="main-container">
    <h1 class="news-feed-title">News Feed</h1>
    <!-- Форма для создания поста -->
    <div class="post-form">
        <form method="post" action="{{ url_for('posts.create_post') }}" enctype="multipart/form-data">
            <textarea name="head_title" placeholder="name of your post" class="head_title-textarea"></textarea>
            <textarea name="post_text" placeholder="What's on your mind?" class="post-textarea"></textarea>
            <input type="file" name="post_image" class="post-image-input">
            <button type="submit" class="post-submit-btn">Post</button>
        </form>
    </div>

    <!-- Фид новостей -->
    {% for post in posts %}
    <div class="news-item">
        <h3 class="post-head_title">Ttitle {{ post['head_title'] }}</h3>
        <h3 class="post-username">
            <a href="{{ url_for('profile.profile', user_id=post['post_owner_id']) }}">{{ post['username'] }}</a>
        </h3>
        {% if post['full_image_url'] %}
        <img src="{{ post['full_image_url'] }}" alt="Post image" loading="lazy" style="max-width: 20%; max-height: 20%;">
        {% endif %}
        <p class="post-text">{{ post['text'] }}</p> <!-- Текст поста -->
        <span class="post-date">{{ post['created_at'] }} date</span> <!-- Дата создания -->
        <!-- Форма для комментариев -->
    <form method="post" action="{{ url_for('posts.create_comment', post_id=post['id']) }}">
      <textarea name="comment_text" placeholder="Add a comment..."></textarea>
      <button type="submit">Comment</button>
    </form>
    <!-- Отображение комментариев к посту -->
    {% for comment in post['comments'] %}
        <div class="comment">
            <p>{{ comment['username'] }}: {{ comment['text'] }}</p>
        </div>
    {% endfor %}
    </div>
{% endfor %}
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
function updatePosts() {
    $.ajax({
        url: '/get_posts',
        type: 'GET',
        dataType: 'json',
        success: function(posts) {
            var postsHtml = '';
            posts.forEach(function(post) {
                postsHtml += '<div class="post">' +
                              '<h2>' + post.head_title + '</h2>' +
                              '<p>' + post.post_text + '</p>' +
                              '</div>';  // Предположим, что у постов есть заголовок и текст
            });
            $('.posts-container').html(postsHtml);
        }
    });
}

$(document).ready(function() {
    updatePosts(); // Обновить посты при загрузке страницы
    setInterval(updatePosts, 5000); // Обновлять посты каждые 5 секунд
});
</script>

{% endblock %}
